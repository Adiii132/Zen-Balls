<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Zen TikTok Balls</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      height: 100%;
      overflow: hidden;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: black;
      touch-action: none;
    }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  // TikTok format
  canvas.width = 1080;
  canvas.height = 1920;

  const W = canvas.width;
  const H = canvas.height;

  const arena = {
    x: W / 2,
    y: H / 2,
    r: 420
  };

  const gravity = 0.35;
  const restitution = 0.88;

  const balls = [];

  class Ball {
    constructor() {
      this.r = 10;
      this.x = arena.x + (Math.random() - 0.5) * 100;
      this.y = arena.y - arena.r + 40;

      this.vx = (Math.random() - 0.5) * 6;
      this.vy = 0;

      this.life = Math.random() * 2000 + 2000; // 2–4s
      this.frozen = false;
    }

    update(dt) {
      if (this.frozen) return;

      this.vy += gravity;
      this.x += this.vx;
      this.y += this.vy;

      this.life -= dt;
      if (this.life <= 0) {
        this.frozen = true;
        this.vx = 0;
        this.vy = 0;
      }

      this.collideArena();
      this.collideFrozen();
    }

    collideArena() {
      const dx = this.x - arena.x;
      const dy = this.y - arena.y;
      const dist = Math.hypot(dx, dy);

      if (dist + this.r > arena.r) {
        const nx = dx / dist;
        const ny = dy / dist;

        const dot = this.vx * nx + this.vy * ny;
        this.vx -= 2 * dot * nx;
        this.vy -= 2 * dot * ny;

        this.vx *= restitution;
        this.vy *= restitution;

        this.x = arena.x + nx * (arena.r - this.r);
        this.y = arena.y + ny * (arena.r - this.r);
      }
    }

    collideFrozen() {
      for (const b of balls) {
        if (b === this || !b.frozen) continue;

        const dx = this.x - b.x;
        const dy = this.y - b.y;
        const dist = Math.hypot(dx, dy);
        const min = this.r + b.r;

        if (dist < min) {
          const nx = dx / dist;
          const ny = dy / dist;

          const overlap = min - dist;
          this.x += nx * overlap;
          this.y += ny * overlap;

          const dot = this.vx * nx + this.vy * ny;
          this.vx -= 2 * dot * nx;
          this.vy -= 2 * dot * ny;
        }
      }
    }

    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
      ctx.fillStyle = this.frozen ? "#555" : "#c78bff";
      ctx.fill();
    }
  }

  function drawArena() {
    ctx.beginPath();
    ctx.arc(arena.x, arena.y, arena.r, 0, Math.PI * 2);
    ctx.strokeStyle = "#ff9f6b";
    ctx.lineWidth = 8;
    ctx.stroke();
  }

  let last = performance.now();

  function loop(t) {
    const dt = t - last;
    last = t;

    ctx.clearRect(0, 0, W, H);

    drawArena();

    for (const b of balls) {
      b.update(dt);
      b.draw();
    }

    requestAnimationFrame(loop);
  }

  function spawn() {
    balls.push(new Ball());
    if (balls.length > 70) balls.shift(); // litość dla telefonu
  }

  spawn();
  setInterval(spawn, 2500);
  requestAnimationFrame(loop);
})();
</script>

</body>
</html>